<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TJCNI Redirect</title>
  <!-- 0초 후 musicspace2로 이동 -->
  <meta http-equiv="refresh" content="0; url=https://tjcni.com/musicspace2/">
</head>
<body>
  <p>Redirecting to <a href="https://tjcni.com/musicspace2/">Musicspace2</a>...</p>
</body>
</html>







<meta http-equiv="refresh" content="0; url=/musicspace2/">

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tommy's Music Space</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="container">
        <div class="profile-header">
            <img src="images/profile.jpg" alt="프로필 사진" class="profile-picture">
            <div class="header-text-content">
                <h1>Tommy's Music Space</h1>
                <p class="intro-text">이곳은 Tommy의 음악을 나누는 공간입니다. 방문을 환영합니다!</p>
            </div>
        </div>
        
        <hr class="section-divider">
        
        <h2 class="section-title">나만의 플레이리스트</h2>
        <div class="playlist-controls">
            <input type="text" id="new-playlist-name" placeholder="새 플레이리스트 이름">
            <button id="create-playlist-btn" class="btn btn-add">생성</button>
        </div>
        <ul class="song-list" id="my-playlist"></ul>
        <div id="playlist-details"></div>
        
        <hr class="section-divider">
        
<h2 class="section-title">장르별 탐색</h2>
        <div id="genre-list" class="genre-container">
            </div>

        <hr class="section-divider">

        <h2 class="section-title">노래 목록</h2>
        <div id="song-list-container">
            </div>
    </div>

    <audio id="music-player" controls></audio>
    
    <div style="text-align: center; margin-top: 50px; margin-bottom: 20px;">
        <a href="admin.html" style="color: #888; font-size: 0.9em;">관리자 페이지로 이동</a>
    </div>
<div id="lyrics-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn">&times;</button>
            <h3 id="modal-song-title"></h3>
            <pre id="modal-lyrics-content"></pre>
        </div>
    </div>


<script>
    // --- 1. 전역 변수 ---
    let activePlaylistId = null;

    const player = document.getElementById('music-player');
    const mainSongListElement = document.getElementById('main-song-list');
    const myPlaylistElement = document.getElementById('my-playlist');
    const createPlaylistBtn = document.getElementById('create-playlist-btn');
    const newPlaylistNameInput = document.getElementById('new-playlist-name');
    const detailsContainer = document.getElementById('playlist-details');
    const container = document.querySelector('.container');
    const modal = document.getElementById('lyrics-modal');
    const genreContainer = document.getElementById('genre-list');
    const songListContainer = document.getElementById('song-list-container');

    // --- 2. 렌더링 함수 (화면 그리기) ---
    function renderPlaylists(playlists) {
        myPlaylistElement.innerHTML = '';
        playlists.forEach(playlist => {
            const listItem = document.createElement('li');
            const link = document.createElement('a');
            link.href = '#';
            link.className = 'playlist-link';
            link.dataset.id = playlist.id;
            link.textContent = playlist.name;
            if (playlist.id == activePlaylistId) {
                link.classList.add('active');
            }
            listItem.appendChild(link);
            myPlaylistElement.appendChild(listItem);
        });
    }
function renderSongsInContainer(songs, containerElement) {
    containerElement.innerHTML = '';
    const songList = document.createElement('ul');
    songList.className = 'song-list';

    if (songs.length === 0) {
        songList.innerHTML = '<li>해당하는 노래가 없습니다.</li>';
    } else {
        songs.forEach(song => {
            const listItem = document.createElement('li');
            listItem.innerHTML = `
                <a href="#" class="play-link" data-src="${song.src}">
                    <div class="song-info">
                        <span class="song-title">${song.title}</span>
                        <span class="song-meta">${song.artist} | ${song.composer} | ${song.date}</span>
                    </div>
                </a>
                <div class="buttons">
                    <button class="btn btn-lyrics" data-song-id="${song.id}">가사</button>
                    <button class="btn btn-add" data-song-id="${song.id}">추가</button>
                </div>
            `;
            songList.appendChild(listItem);
        });
    }
    containerElement.appendChild(songList);
}

    function renderPlaylistDetails(playlist) {
        detailsContainer.innerHTML = '';
        const titleElement = document.createElement('h3');
        titleElement.textContent = `[${playlist.name}] 수록곡`;
        detailsContainer.appendChild(titleElement);

        const songsUl = document.createElement('ul');
        songsUl.className = 'song-list';

        if (playlist.Songs && playlist.Songs.length > 0) {
            playlist.Songs.forEach(song => {
                const songLi = document.createElement('li');
                songLi.innerHTML = `
                    <a href="#" class="play-link" data-src="${song.src}">
                        <div class="song-info">
                            <span class="song-title">${song.title}</span>
                            <span class="song-meta">${song.artist} | ${song.composer}</span>
                        </div>
                    </a>
                    <button class="btn btn-delete" data-song-id="${song.id}">삭제</button>
                `;
                songsUl.appendChild(songLi);
            });
        } else {
            songsUl.innerHTML = '<li>담긴 노래가 없습니다.</li>';
        }
        detailsContainer.appendChild(songsUl);
    }

    // --- 3. 데이터 통신 함수 (서버와 대화) ---
    async function fetchPlaylists() {
        try {
            const response = await fetch('/api/playlists');
            return await response.json();
        } catch (error) {
            console.error("플레이리스트를 불러오는 중 오류 발생:", error);
            return [];
        }
    }
    
    async function fetchGenres() {
        try {
            const response = await fetch('/api/genres');
            return await response.json();
        } catch (error) {
            console.error("장르 목록을 불러오는 중 오류 발생:", error);
            return [];
        }
    }

    // --- 4. 이벤트 처리 ---
    function setupEventListeners() {
        container.addEventListener('click', async function(event) {
            const target = event.target;

            // ... (기존의 노래 재생, 플레이리스트 선택, 가사, 추가, 삭제 로직은 모두 그대로) ...
            
            // '장르' 버튼 클릭 로직
            // 교체할 코드
if (target.matches('.genre-btn')) {
    const genreName = target.dataset.genre;
    
    // 이전에 선택된 장르와 같다면 선택 해제 (토글 기능)
    if (target.classList.contains('active')) {
        target.classList.remove('active');
        songListContainer.innerHTML = ''; // 노래 목록 비우기
        return;
    }

    document.querySelectorAll('.genre-btn').forEach(btn => btn.classList.remove('active'));
    target.classList.add('active');

    try {
        const response = await fetch(`/api/songs/genre/${encodeURIComponent(genreName)}`);
        const songs = await response.json();
        
        // 이전에 만들었던 렌더링 함수를 사용하여 노래 목록을 그림
        renderSongsInContainer(songs, songListContainer); 
    } catch (error) {
        console.error('장르별 노래 로딩 오류:', error);
    }
    return;
}
        });

        createPlaylistBtn.addEventListener('click', async () => { /* ... (기존과 동일) ... */ });
        modal.addEventListener('click', function(event) { /* ... (기존과 동일) ... */ });
    }

    // --- 5. 초기 실행 ---
    async function init() {
        const playlists = await fetchPlaylists();
        renderPlaylists(playlists);

        const genres = await fetchGenres();
        genreContainer.innerHTML = '';
        genres.forEach(genre => {
            const genreBtn = document.createElement('button');
            genreBtn.className = 'genre-btn';
            genreBtn.textContent = genre;
            genreBtn.dataset.genre = genre;
            genreContainer.appendChild(genreBtn);
        });
        
        setupEventListeners();
    }

    init();
</script>
</body>
</html>